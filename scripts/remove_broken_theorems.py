#!/usr/bin/env python3
"""Remove theorems whose states cause SGLang encoding failures from all index files."""

import json

BAD_THEOREMS = {
    "AkraBazziRecurrence.GrowsPolynomially.div",
    "AkraBazziRecurrence.GrowsPolynomially.eventually_atTop_nonneg_or_nonpos",
    "AkraBazziRecurrence.GrowsPolynomially.neg",
    "AkraBazziRecurrence.GrowsPolynomially.of_isTheta",
    "AkraBazziRecurrence.GrowsPolynomially.rpow",
    "AkraBazziRecurrence.growsPolynomially_const",
    "AlgebraicGeometry.PresheafedSpace.ColimitCoconeIsColimit.desc_fac",
    "AlgebraicGeometry.PresheafedSpace.GlueData.f_invApp_f_app",
    "AlgebraicGeometry.PresheafedSpace.GlueData.snd_invApp_t_app",
    "AlgebraicGeometry.PresheafedSpace.GlueData.snd_invApp_t_app'",
    "AlgebraicGeometry.PresheafedSpace.IsOpenImmersion.inv_naturality",
    "AlgebraicGeometry.PresheafedSpace.IsOpenImmersion.isIso_of_subset",
    "AlgebraicGeometry.PresheafedSpace.IsOpenImmersion.lift_uniq",
    "AlgebraicGeometry.PresheafedSpace.IsOpenImmersion.pullbackConeOfLeftLift_fst",
    "AlgebraicGeometry.PresheafedSpace.congr_app",
    "AlgebraicGeometry.PresheafedSpace.map_comp_c_app",
    "AlgebraicGeometry.PresheafedSpace.map_id_c_app",
    "AlgebraicGeometry.PresheafedSpace.stalkMap.congr",
    "AlgebraicGeometry.PresheafedSpace.stalkMap.congr_hom",
    "AlgebraicGeometry.SheafedSpace.IsOpenImmersion.of_stalk_iso",
    "Cardinal.cantor",
    "Cardinal.isUnit_iff",
    "CategoryTheory.Abelian.FunctorCategory.coimageImageComparison_app",
    "CategoryTheory.Abelian.Pseudoelement.epi_of_pseudo_surjective",
    "CategoryTheory.Abelian.Pseudoelement.zero_morphism_ext",
    "CategoryTheory.Abelian.Pseudoelement.zero_of_map_zero",
    "CategoryTheory.Abelian.coimageIsoImage'_hom",
    "CategoryTheory.Abelian.epi_fst_of_isLimit",
    "CategoryTheory.Adjunction.projective_of_map_projective",
    "CategoryTheory.Biprod.inl_ofComponents",
    "CategoryTheory.BraidedCategory.braiding_inv_tensor_left",
    "CategoryTheory.BraidedCategory.yang_baxter'",
    "CategoryTheory.ConcreteCategory.isIso_iff_bijective",
    "CategoryTheory.CosimplicialObject.δ_comp_δ'",
    "CategoryTheory.CosimplicialObject.δ_comp_σ_of_gt'",
    "CategoryTheory.Equalizer.FirstObj.ext",
    "CategoryTheory.Equalizer.Presieve.Arrows.FirstObj.ext",
    "CategoryTheory.Equalizer.Sieve.compatible_iff",
    "CategoryTheory.Equalizer.Sieve.equalizer_sheaf_condition",
    "CategoryTheory.Equalizer.Sieve.w",
    "CategoryTheory.FinitaryExtensive.isVanKampen_finiteCoproducts",
    "CategoryTheory.FinitaryExtensive.vanKampen",
    "CategoryTheory.FinitaryPreExtensive.isUniversal_finiteCoproducts",
    "CategoryTheory.Functor.mapHomologicalComplex_upToQuasiIso_Q_inverts_quasiIso",
    "CategoryTheory.Functor.map_inv",
    "CategoryTheory.Functor.ranges_directed",
    "CategoryTheory.FunctorToTypes.prodMk_snd",
    "CategoryTheory.Grothendieck.ext",
    "CategoryTheory.GrothendieckTopology.Cover.preOneHypercover_sieve₁",
    "CategoryTheory.GrothendieckTopology.OneHypercoverFamily.IsSheafIff.hom_ext",
    "CategoryTheory.GrothendieckTopology.WEqualsLocallyBijective.mk'",
    "CategoryTheory.GrothendieckTopology.bot_covers",
    "CategoryTheory.GrothendieckTopology.coversTop_iff_of_isTerminal",
    "CategoryTheory.GrothendieckTopology.diagramNatTrans_id",
    "CategoryTheory.GrothendieckTopology.ext",
    "CategoryTheory.GrothendieckTopology.isGLB_sInf",
    "CategoryTheory.GrothendieckTopology.isIso_toPlus_of_isSheaf",
    "CategoryTheory.GrothendieckTopology.isoToPlus_inv",
    "CategoryTheory.GrothendieckTopology.over_map_compatiblePreserving",
    "CategoryTheory.GrothendieckTopology.plusCompIso_whiskerRight",
    "CategoryTheory.GrothendieckTopology.sheafificationWhiskerRightIso_hom_app",
    "CategoryTheory.GrothendieckTopology.sheafifyCompIso_inv_eq_sheafifyLift",
    "CategoryTheory.GrothendieckTopology.toPlus_naturality",
    "CategoryTheory.HomOrthogonal.equiv_of_iso",
    "CategoryTheory.HomOrthogonal.matrixDecomposition_id",
    "CategoryTheory.InjectiveResolution.homotopyEquiv_hom_ι",
    "CategoryTheory.InjectiveResolution.isoRightDerivedObj_hom_naturality",
    "CategoryTheory.IsCofiltered.inf_objs_exists",
    "CategoryTheory.IsCofiltered.small_fullSubcategory_cofilteredClosure",
    "CategoryTheory.IsFiltered.bowtie",
    "CategoryTheory.IsFiltered.iff_nonempty_limit",
    "CategoryTheory.IsFiltered.tulip",
    "CategoryTheory.IsIso.inv_eq_of_inv_hom_id",
    "CategoryTheory.IsIso.inv_hom_id_assoc",
    "CategoryTheory.IsKernelPair.of_isIso_of_mono",
    "CategoryTheory.IsVanKampenColimit.of_iso",
    "CategoryTheory.IsVanKampenColimit.of_mapCocone",
    "CategoryTheory.Iso.trans_refl",
    "CategoryTheory.Limits.CokernelCofork.IsColimit.isIso_π",
    "CategoryTheory.Limits.Concrete.Pi.map_ext",
    "CategoryTheory.Limits.Concrete.from_union_surjective_of_isColimit",
    "CategoryTheory.Limits.Concrete.isColimit_exists_of_rep_eq",
    "CategoryTheory.Limits.Concrete.multiequalizer_ext",
    "CategoryTheory.Limits.Concrete.widePullback_ext'",
    "CategoryTheory.Limits.Concrete.widePushout_exists_rep",
    "CategoryTheory.Limits.Fork.ofCone_π",
    "CategoryTheory.Limits.Fork.π_comp_hom",
    "CategoryTheory.Limits.HasLimit.isoOfEquivalence_hom_π",
    "CategoryTheory.Limits.IsBilimit.total",
    "CategoryTheory.Limits.IsImage.e_isoExt_hom",
    "CategoryTheory.Limits.IsZero.iff_id_eq_zero",
    "CategoryTheory.Limits.IsZero.of_iso",
    "CategoryTheory.Limits.IsZero.of_mono",
    "CategoryTheory.Limits.KernelFork.IsLimit.isIso_ι",
    "CategoryTheory.Limits.Multifork.app_right_eq_ι_comp_fst",
    "CategoryTheory.Limits.PullbackCone.mono_fst_of_is_pullback_of_mono",
    "CategoryTheory.Limits.PullbackCone.mono_snd_of_is_pullback_of_mono",
    "CategoryTheory.Limits.Sigma.map_id",
    "CategoryTheory.Limits.Types.zigzag_of_eqvGen_quot_rel",
    "CategoryTheory.Limits.WidePullback.hom_eq_lift",
    "CategoryTheory.Limits.WidePullback.hom_ext",
    "CategoryTheory.Limits.WidePushout.eq_desc_of_comp_eq",
    "CategoryTheory.Limits.WidePushout.head_desc",
    "CategoryTheory.Limits.biproduct.components_matrix",
    "CategoryTheory.Limits.biproduct.fromSubtype_π_subtype",
    "CategoryTheory.Limits.biproduct.lift_map",
    "CategoryTheory.Limits.biproduct.matrix_map",
    "CategoryTheory.Limits.biproduct.ι_toSubtype_subtype",
    "CategoryTheory.Limits.coequalizerComparison_map_desc",
    "CategoryTheory.Limits.cokernel_map_comp_cokernelComparison",
    "CategoryTheory.Limits.colimit.post_post",
    "CategoryTheory.Limits.colimit.pre_id",
    "CategoryTheory.Limits.colimit.pre_post",
    "CategoryTheory.Limits.comp_factorThruImage_eq_zero",
    "CategoryTheory.Limits.coprod.desc_comp_inl_comp_inr",
    "CategoryTheory.Limits.coprod.map_comp_inl_inr_codiag",
    "CategoryTheory.Limits.coprod.map_desc",
    "CategoryTheory.Limits.equalizer.isoSourceOfSelf_inv",
    "CategoryTheory.Limits.factorThruImageSubobject_comp_self",
    "CategoryTheory.Limits.hasLimitsOfShape_of_equivalence",
    "CategoryTheory.Limits.image.compIso_hom_comp_image_ι",
    "CategoryTheory.Limits.image.eq_fac",
    "CategoryTheory.Limits.image.map_id",
    "CategoryTheory.Limits.image.map_ι",
    "CategoryTheory.Limits.image.preComp_comp",
    "CategoryTheory.Limits.image.ι_zero",
    "CategoryTheory.Limits.imageMonoIsoSource_hom_self",
    "CategoryTheory.Limits.imageSubobjectCompIso_inv_arrow",
    "CategoryTheory.Limits.inl_inl_pushoutAssoc_hom",
    "CategoryTheory.Limits.inr_inl_pushoutAssoc_hom",
    "CategoryTheory.Limits.inr_inr_pushoutAssoc_inv",
    "CategoryTheory.Limits.inr_pushoutAssoc_hom",
    "CategoryTheory.Limits.kernel.lift_map",
    "CategoryTheory.Limits.kernelComparison_comp_kernel_map",
    "CategoryTheory.Limits.kernelSubobjectMap_arrow",
    "CategoryTheory.Limits.kernelSubobject_zero",
    "CategoryTheory.Limits.kernelZeroIsoSource_inv",
    "CategoryTheory.Limits.limit.lift_map",
    "CategoryTheory.Limits.limit.post_post",
    "CategoryTheory.Limits.limitObjIsoLimitCompEvaluation_hom_π",
    "CategoryTheory.Limits.limit_map_limitObjIsoLimitCompEvaluation_hom",
    "CategoryTheory.Limits.map_lift_equalizerComparison",
    "CategoryTheory.Limits.map_lift_kernelComparison",
    "CategoryTheory.Limits.mono_of_source_iso_zero",
    "CategoryTheory.Limits.parallelPair_functor_obj",
    "CategoryTheory.Limits.prod.diag_map_fst_snd",
    "CategoryTheory.Limits.prod.lift_fst_snd",
    "CategoryTheory.Limits.prod.pentagon",
    "CategoryTheory.Limits.prod_rightUnitor_inv_naturality",
    "CategoryTheory.Limits.pullback.congrHom_inv",
    "CategoryTheory.Limits.pullbackAssoc_hom_fst",
    "CategoryTheory.Limits.pullbackAssoc_hom_snd_fst",
    "CategoryTheory.Limits.pushout.congrHom_inv",
    "CategoryTheory.Limits.zero_of_from_zero",
    "CategoryTheory.Limits.zero_of_to_zero",
    "CategoryTheory.Limits.ι_colimitLimitIso_limit_π",
    "CategoryTheory.Meq.congr_apply",
    "CategoryTheory.Meq.equiv_symm_eq_apply",
    "CategoryTheory.MonoidalCategory.inv_hom_id_tensor",
    "CategoryTheory.MonoidalCategory.inv_hom_id_tensor'",
    "CategoryTheory.MonoidalCategory.pentagon_hom_hom_inv_inv_hom",
    "CategoryTheory.MonoidalCategory.whiskerLeft_hom_inv'",
    "CategoryTheory.MorphismProperty.FunctorsInverting.ext",
    "CategoryTheory.MorphismProperty.IsInvertedBy.unop",
    "CategoryTheory.MorphismProperty.RespectsIso.inverseImage",
    "CategoryTheory.MorphismProperty.inverseImage_equivalence_inverse_eq_map_functor",
    "CategoryTheory.MorphismProperty.map_id_eq_isoClosure",
    "CategoryTheory.MorphismProperty.map_isoClosure",
    "CategoryTheory.MorphismProperty.universally_respectsIso",
    "CategoryTheory.NatTrans.equifibered_of_discrete",
    "CategoryTheory.NatTrans.rightDerived_id",
    "CategoryTheory.NonPreadditiveAbelian.add_comm",
    "CategoryTheory.NonPreadditiveAbelian.lift_σ",
    "CategoryTheory.NonPreadditiveAbelian.neg_neg",
    "CategoryTheory.NonPreadditiveAbelian.sub_sub_sub",
    "CategoryTheory.Over.over_hasTerminal",
    "CategoryTheory.OverPresheafAux.YonedaCollection.map₂_comp",
    "CategoryTheory.OverPresheafAux.YonedaCollection.map₂_id",
    "CategoryTheory.OverPresheafAux.counitBackward_counitForward",
    "CategoryTheory.OverPresheafAux.unitBackward_unitForward",
    "CategoryTheory.PreOneHypercover.sieve₁_eq_pullback_sieve₁'",
    "CategoryTheory.Preadditive.epi_iff_surjective",
    "CategoryTheory.Preadditive.mono_iff_injective",
    "CategoryTheory.Preadditive.mono_of_isZero_kernel'",
    "CategoryTheory.Presheaf.equalizerSieve_eq_top_iff",
    "CategoryTheory.Presheaf.imageSieve_app",
    "CategoryTheory.Presheaf.isLocallyInjective_of_injective",
    "CategoryTheory.Presheaf.isLocallyInjective_of_isLocallyInjective_of_isLocallySurjective",
    "CategoryTheory.Presheaf.isLocallySurjective_of_isLocallySurjective",
    "CategoryTheory.Presheaf.isLocallySurjective_of_surjective",
    "CategoryTheory.PresheafHom.IsSheafFor.exists_app",
    "CategoryTheory.Pretriangulated.Triangle.eqToHom_hom₂",
    "CategoryTheory.Pretriangulated.Triangle.eqToHom_hom₃",
    "CategoryTheory.Pretriangulated.Triangle.mor₂_eq_zero_iff_epi₁",
    "CategoryTheory.Pretriangulated.Triangle.mor₃_eq_zero_iff_epi₂",
    "CategoryTheory.Pretriangulated.binaryBiproductTriangle_distinguished",
    "CategoryTheory.Pretriangulated.contractible_distinguished₂",
    "CategoryTheory.Pretriangulated.isIso₂_of_isIso₁₃",
    "CategoryTheory.Pretriangulated.isIso₃_of_isIso₁₂",
    "CategoryTheory.Projective.projective_iff_preservesEpimorphisms_preadditiveCoyoneda_obj",
    "CategoryTheory.ProjectiveResolution.isoLeftDerivedObj_hom_naturality",
    "CategoryTheory.ProjectiveResolution.leftDerived_app_eq",
    "CategoryTheory.ProjectiveResolution.π_f_succ",
    "CategoryTheory.Quotient.compClosure_iff_self",
    "CategoryTheory.Sheaf.isSheafFor_bind",
    "CategoryTheory.ShiftMkCore.add_zero_inv_app",
    "CategoryTheory.ShortComplex.Exact.epi_f_iff",
    "CategoryTheory.ShortComplex.HomologyData.right_homologyIso_eq_left_homologyIso_trans_iso",
    "CategoryTheory.ShortComplex.HomologyMapData.congr_left_φH",
    "CategoryTheory.ShortComplex.RightHomologyData.homologyIso_inv_comp_homologyι",
    "CategoryTheory.ShortComplex.RightHomologyMapData.homologyMap_eq",
    "CategoryTheory.ShortComplex.ShortExact.surjective_g",
    "CategoryTheory.ShortComplex.epi_homologyMap_of_epi_cyclesMap'",
    "CategoryTheory.ShortComplex.homologyMap_op",
    "CategoryTheory.ShortComplex.isIso_homologyMap_of_isIso_cyclesMap_of_epi",
    "CategoryTheory.ShortComplex.isIso₂_of_shortExact_of_isIso₁₃",
    "CategoryTheory.ShortComplex.leftRightHomologyComparison'_fac",
    "CategoryTheory.ShortComplex.mono_homologyMap_of_mono_opcyclesMap'",
    "CategoryTheory.ShortComplex.π_leftRightHomologyComparison'_ι",
    "CategoryTheory.Sieve.functorPushforward_over_map",
    "CategoryTheory.Sieve.overEquiv_top",
    "CategoryTheory.SimplicialObject.eqToIso_refl",
    "CategoryTheory.SimplicialObject.δ_comp_σ_of_gt'",
    "CategoryTheory.SmallObject.ιFunctorObj_naturality",
    "CategoryTheory.SmallObject.ρFunctorObj_π",
    "CategoryTheory.StrongEpi.iff_of_arrow_iso",
    "CategoryTheory.adhesive_of_reflective",
    "CategoryTheory.cokernel_zero_of_nonzero_to_simple",
    "CategoryTheory.essentiallySmall_iff",
    "CategoryTheory.exact_d_f",
    "CategoryTheory.exact_f_d",
    "CategoryTheory.expComparison_whiskerLeft",
    "CategoryTheory.finitaryExtensive_of_preserves_and_reflects",
    "CategoryTheory.hasFiniteProducts_of_has_binary_and_terminal",
    "CategoryTheory.hasInitial_of_weakly_initial_and_hasWideEqualizers",
    "CategoryTheory.id_nonzero",
    "CategoryTheory.indecomposable_of_simple",
    "CategoryTheory.isPullback_of_cofan_isVanKampen",
    "CategoryTheory.isSeparator_iff_faithful_preadditiveCoyoneda",
    "CategoryTheory.isUniversalColimit_extendCofan",
    "CategoryTheory.kernel_zero_of_nonzero_from_simple",
    "CategoryTheory.obj_ε_app",
    "CategoryTheory.presheafHom_map_app",
    "CategoryTheory.sheafComposeIso_inv_fac",
    "CategoryTheory.shiftComm_symm",
    "CategoryTheory.shiftFunctorAdd'_assoc_hom_app",
    "CategoryTheory.shiftFunctorAdd_add_zero_inv_app",
    "CategoryTheory.shiftFunctorAdd_zero_add_hom_app",
    "CategoryTheory.shiftFunctorComm_hom_app_comp_shift_shiftFunctorAdd_hom_app",
    "CategoryTheory.shiftFunctorZero_hom_app_shift",
    "CategoryTheory.shiftFunctorZero_inv_app_shift",
    "CategoryTheory.shift_shift'",
    "CategoryTheory.shift_shiftFunctorCompIsoId_hom_app",
    "CategoryTheory.shift_shiftFunctorCompIsoId_inv_app",
    "CategoryTheory.simple_iff_subobject_isSimpleOrder",
    "CategoryTheory.simple_of_cosimple",
    "CategoryTheory.strict_initial",
    "CategoryTheory.topologyOfClosureOperator_self",
    "CategoryTheory.transferNatTransSelf_comp",
    "CategoryTheory.whisker_eq",
    "CochainComplex.HomComplex.Cochain.comp_add",
    "CochainComplex.HomComplex.Cochain.comp_assoc_of_second_is_zero_cochain",
    "CochainComplex.HomComplex.Cochain.comp_id",
    "CochainComplex.HomComplex.Cochain.congr_v",
    "CochainComplex.HomComplex.Cochain.d_comp_ofHoms_v",
    "CochainComplex.HomComplex.Cochain.id_comp",
    "CochainComplex.HomComplex.Cochain.leftShift_comp",
    "CochainComplex.HomComplex.Cochain.leftShift_comp_zero_cochain",
    "CochainComplex.HomComplex.Cochain.leftShift_units_smul",
    "CochainComplex.HomComplex.Cochain.leftShift_v",
    "CochainComplex.HomComplex.Cochain.leftUnshift_neg",
    "CochainComplex.HomComplex.Cochain.rightShift_add",
    "CochainComplex.HomComplex.Cochain.rightShift_leftShift",
    "CochainComplex.HomComplex.Cochain.rightShift_rightUnshift",
    "CochainComplex.HomComplex.Cochain.rightUnshift_v",
    "CochainComplex.HomComplex.Cochain.shift_units_smul",
    "CochainComplex.HomComplex.Cochain.shift_v",
    "CochainComplex.HomComplex.Cochain.shift_v'",
    "CochainComplex.HomComplex.Cochain.v_comp_XIsoOfEq_hom",
    "CochainComplex.HomComplex.Cocycle.homOf_ofHom_eq_self",
    "CochainComplex.HomComplex.δ_comp",
    "CochainComplex.HomComplex.δ_map",
    "CochainComplex.HomComplex.δ_zero_cochain_v",
    "CochainComplex.HomComplex.δ_zero_cocycle_comp",
    "CochainComplex.shiftFunctorAdd_hom_app_f",
    "Cubic.of_a_eq_zero",
    "FiniteField.isSquare_iff",
    "FiniteField.pow_dichotomy",
    "Finsupp.neLocus_comm",
    "HomologicalComplex.singleObjCyclesSelfIso_hom_naturality",
    "HomologicalComplex.singleObjHomologySelfIso_inv_homologyι",
    "IsChain.exists_maxChain",
    "List.map_permutations",
    "Mathlib.Meta.NormNum.ble_eq_false",
    "Matrix.PosDef.of_toQuadraticForm'",
    "Matrix.PosDef.toQuadraticForm'",
    "Nat.le_div_two_iff_mul_two_le",
    "ONote.eq_of_cmp_eq",
    "PiNat.eq_of_dist_eq_zero",
    "Real.logb_lt_iff_lt_rpow_of_base_lt_one",
    "TopCat.Presheaf.app_surjective_of_stalkFunctor_map_bijective",
    "TopCat.Presheaf.ext",
    "TopCat.Presheaf.section_ext",
    "TopCat.Presheaf.stalkSpecializes_stalkFunctor_map",
    "TopCat.Presheaf.stalk_hom_ext",
    "TopCat.Sheaf.hom_ext",
    "not_fermatLastTheoremFor_one",
    "quasiIsoAt_iff_comp_right",
    "quasiIsoAt_iff_exactAt'",
}


def filter_json(path):
    with open(path) as f:
        data = json.load(f)
    before = len(data["theorems"])
    data["theorems"] = [t for t in data["theorems"] if t["name"] not in BAD_THEOREMS]
    after = len(data["theorems"])
    removed = before - after
    if removed > 0:
        with open(path, "w") as f:
            json.dump(data, f, indent=2, ensure_ascii=False)
            f.write("\n")
    print(f"  {path}: {before} -> {after} (removed {removed})")
    return removed


if __name__ == "__main__":
    print(f"Removing {len(BAD_THEOREMS)} theorems with broken SGLang encodings")
    total = 0
    for path in [
        "data/theorem_index.json",
        "data/train_eval_theorems.json",
        "data/ebm_trivial_theorems.json",
    ]:
        try:
            total += filter_json(path)
        except FileNotFoundError:
            print(f"  {path}: not found, skipping")
    print(f"Total removed: {total}")
